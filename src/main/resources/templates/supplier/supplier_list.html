<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Listado de Proveedores - Agrow</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" th:href="@{/css/common.css}" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
</head>
<body>

    <div th:replace="~{fragments/sidebar :: sidebar}"></div>

    <div class="main-content">
        <div id="swal-message" th:data-mensaje="${mensaje}" th:data-error="${error}"></div>

        <div class="page-header">
            <div>
                <h1 class="page-title">Gestión de Proveedores</h1>
                <p class="page-subtitle">Visualiza y administra los proveedores. Total: <span th:text="${listS != null ? listS.size() : 0}">0</span></p>
            </div>
            <a th:href="@{/suppliers/form}" class="btn btn-primary"> <span class="material-symbols-outlined icon">add_business</span> Agregar Proveedor </a>
        </div>

        <form id="filter-form-supplier" th:action="@{/suppliers/list}" method="get" class="filter-section">
            <!-- ... (Formulario de filtro sin cambios) ... -->
             <div class="filter-row">
                <div class="filter-group">
                    <label class="filter-label" for="search">Buscar por ID, Contacto o Empresa</label>
                    <input type="text" id="search" name="search" th:value="${searchTerm}" class="filter-input" placeholder="ID, contacto o empresa..." maxlength="100" />
                </div>
                <div class="filter-buttons">
                    <button type="submit" class="btn btn-primary"> <span class="material-symbols-outlined icon">search</span> Filtrar </button>
                    <a th:href="@{/suppliers/list}" class="btn btn-secondary"> <span class="material-symbols-outlined icon">refresh</span> Restablecer </a>
                </div>
            </div>
        </form>

        <div class="info-card" th:if="${validate != null}">
            <span class="material-symbols-outlined icon">info</span>
            <h2 th:text="${validate}">No se encontraron proveedores</h2>
            <p>Intenta con otro término o <a th:href="@{/suppliers/form}">agrega un nuevo proveedor</a>.</p>
        </div>

        <div class="table-container" th:unless="${validate != null or listS == null or listS.isEmpty()}">
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Empresa</th> <th>Contacto</th> <th>Teléfono</th> <th>Correo</th> <th>Registro</th> <th>Estado</th> <th>Crédito</th> <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="tempSupplier : ${listS}">
                            <td th:text="${tempSupplier.companyName}"></td>
                            <td th:text="${tempSupplier.supplierName}"></td>
                            <td th:text="${tempSupplier.getFormattedPhoneNumber()}"></td>
                            <td th:text="${tempSupplier.email}"></td>
                            <td th:text="${tempSupplier.getFormattedRegistrationDate()}"></td>
                            <td> <span class="status" th:classappend="${tempSupplier.isActive()} ? 'status-optimo' : 'status-bajo'" th:text="${tempSupplier.isActive()} ? 'Activo' : 'Inactivo'"></span> </td>
                            <!-- CORRECCIÓN: creditLimit SÍ es moneda, mantener price-display -->
                            <td class="price-display" th:attr="data-value=${tempSupplier.creditLimit}"></td>
                            <td>
                                <div class="action-buttons">
                                    <a th:href="@{/suppliers/view(id=${tempSupplier.supplierIdentification})}" class="btns view-btns" title="Ver Detalles"> <span class="material-symbols-outlined icon">visibility</span> </a>
                                    <a th:href="@{/suppliers/edit(id=${tempSupplier.supplierIdentification})}" class="btns edit-btns" title="Editar Proveedor"> <span class="material-symbols-outlined icon">edit</span> </a>
                                    <form th:action="@{/suppliers/delete}" method="post" class="confirm-action" data-message="¿Eliminar este proveedor?" data-title="Confirmar Eliminación" style="margin:0; padding:0; display:inline;">
                                        <input type="hidden" name="id" th:value="${tempSupplier.supplierIdentification}" />
                                        <button type="submit" class="btns delete-btns" title="Eliminar Proveedor"> <span class="material-symbols-outlined icon">delete</span> </button>
                                    </form>
                                    <a th:href="@{/supplies/form(supplierId=${tempSupplier.supplierIdentification})}" class="btns add-supply-btn" title="Agregar Suministro"> <span class="material-symbols-outlined icon">add_shopping_cart</span> </a>
                                    <a th:href="@{/supplies/list(supplierId=${tempSupplier.supplierIdentification})}" class="btns view-supply-btn" title="Ver Suministros"> <span class="material-symbols-outlined icon">inventory_2</span> </a>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div style="margin-top: 20px;">
            <a th:href="@{/home}" class="btn btn-secondary"> <span class="material-symbols-outlined icon">arrow_back</span> Volver a Inicio </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script th:src="@{/js/app.js}"></script> <!-- Asegúrate que app.js aplique formatPrices -->
</body>
</html>